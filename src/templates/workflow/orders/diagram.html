<div id="step-diagram"></div>

<div id="step-diagram-details">
  <div id="order-info">
    <table class="table table-stripped table-condensed table-bordered table-align-left">
      <tbody>
        <tr>
          <th>Instance ID</th>
          <td><%= model.get('workflow_instanceid') %></td>
          <th>Status</th>
          <td><%= wrapStatus(model.get('workflowstatus')) %></td>
        </tr>
        <tr>
          <th>Started</th>
          <td><%= model.get('started') %></td>
          <th>Custom</th>
          <td><%= model.get('custom_status') %></td>
        </tr>
        <tr>
          <th>Modified</th>
          <td><%= model.get('modified') %></td>
          <th>Priority</th>
          <td class="editable" data-action="setPriority" data-type="integer" data-name="priority" data-max-length="6"><%= model.get('priority') %></td>
        </tr>
        <tr>
          <th>Completed</th>
          <td><%= model.get('completed') %></td>
          <th>Parent ID</th>
          <td><%= model.get('parent_workflow_instanceid') %></td>
        </tr>
        <tr>
          <th>Scheduled</th>
          <td class="editable date" data-action="Reschedule" data-name="scheduled" data-type="date"><%= model.get('scheduled') %></td>
          <th>Synchronous</th>
          <td><%= statusIcon(model.get('synchronous')) %></td>
        </tr>
      </tbody>
    </table>
  </div>
  <div id="order-keys">
    <h4>Keys</h4>
    <table class="table table-stripped table-condensed table-bordered table-align-left">
      <thead>
        <tr>
          <th>Key</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <% if (model.get('keys')) { %>
        <% _.each(model.get('keys'), function (v, k) {%>
          <tr>
            <td><%= k %></td>
            <td><%= v %></td>
          </tr>
        <% }) %>
        <% } else { %>
          <tr>
            <td colspan="2">No data to display</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
  <div>
    <h4>Step Details</h4>
    <div id="step-detail">
      <table class="table table-condensed table-striped table-bordered table-align-left">
        <tbody>
          <tr>
            <th class="narrow">Name</th>
            <td></td>
          </tr>
          <tr>
            <th>Type</th>
            <td></td>
          </tr>
          <tr>
            <th>Started</th>
            <td class="date"></td>
          </tr>
          <tr>
            <th>Completed</th>
            <td class="date"></td>
          </tr>
          <tr>
            <th>Status</th>
            <td></td>
          </tr>
          <tr>
            <th>Status</th>
            <td></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div>
    <h4>Hierarchy</h4>
    <div id="order-hierarchy">
      <% if (model.get('hierarchy_tree')) { %>
      <table class="table table-striped table-hover table-condensed table-align-left">
        <thead>
          <tr>
            <th>Instance ID</th>
            <th>Name</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <% _.each(model.get('hierarchy_tree').flatten(), function(child) { %>
          <% var ha = child.el.opts; %>
          <% var level = (child.el.hasChildren()) ? child.level-1 : child.level %>
          <tr class="<%= (child.el.hasChildren()) ? 'branch' : 'leaf' %>" data-tree-id="<%= child.path %>">
            <td class="nowrap">
              <% _.each(_.range(level), function () { %>
                <span class="indent"></span>
              <% }) %>
              <% if (child.el.hasChildren()) { %>
                <span class="tree-caret" data-branch-id="<%= child.path %>" data-level="<%= level %>"><i class="icon-caret-down icon-large"></i></span>
              <% } %>
              <a href="<%= getUrl('showOrder', { id : ha.workflow_instanceid }) %>"><%= ha.workflow_instanceid %></a>
            </td>
            <td class="nowrap"><a href="<%= getUrl('showWorkflow', { id : ha.workflowid }) %>"><%= ha.name %></a></td>
            <td><%= wrapStatus(ha.workflowstatus) %></td>
          </tr>
          <% }) %>
        </tbody>
      </table>
      <% } %>
    </div>
  </div>
</div>

<div id="step-errors"></div>