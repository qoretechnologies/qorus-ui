<div id="workflows">
  <h2>Workflows</h2>
  <div id="workflows-toolbar" class="toolbar"></div>
	<table class="table table-striped table-hover table-fixed">
		<thead class="header">
		<tr>
      <th></th>
      <th data-sort="workflowid">ID</th>
      <th data-sort="exec_count">Exec Count</th>
      <th data-sort="name" class="name sort">Name</th>
      <th data-sort="version">Version</th>
      <th data-sort="IN-PROGRESS" data-toggle="tooltip" title="In Progress">P</th>
      <th data-sort="COMPLETE" data-toggle="tooltip" title="Complete">C</th>
      <th data-sort="ERROR" title="Error">E</th>
      <th data-sort="ASYNC-WAITING" title="Async Waiting">A</th>
      <th data-sort="WAITING" title="Waiting">W</th>
      <th data-sort="INCOMPLETE" title="Incomplete">I</th>
      <th data-sort="CANCELED" title="Canceled">X</th>
      <th data-sort="RETRY" title="Retry">R</th>
      <th data-sort="READY" title="Ready">Y</th>
      <th data-sort="BLOCKED" title="Blocked">B</th>
      <th data-sort="EVENT-WAITING" title="Event Waiting">E</th>
      <th data-sort="SCHEDULED" title="Scheduled">S</th>
      <th></th>
		</tr>
		</thead>
		<tbody>
	        <% _.each( items, function( workflow ){ 
            var wfl = workflow.toJSON();
            var url = ['#/workflows/view', wfl.workflowid, 'orders'].join('/');
            var date = wfl.date || workflow.collection.date || none;
            function getUrl(s){
              var params = ['#/workflows/view', wfl.workflowid, 'orders', s];
              if (date){
                params.push(date);
              }
              return params.join('/');
            };
            function wrapBadge(v, u, e){
              var res = '<a href="' + u +'">'+ v +'</a>';
              if (v < 1) {
                return res;
              }
              return '<span class="badge ' + e + '">' + res + '</span>';
            };
            %>
	  			<tr class="workflow-row" id="workflow-<%= wfl.workflowid %>" data-id="<%= wfl.workflowid %>">
  					<td><i class="icon-check-empty check"></i></td>
    				<td class="id"><%= wfl.workflowid %></td>
    				<td class="err instances"><%= wrapBadge(wfl.exec_count, ['#/workflows/view', wfl.workflowid, 'instances'].join('/'), 'badge-success') %></td>
    				<td class="name" data-search="<%= wfl.name.toLowerCase() %>"><a href="<%= getUrl('all') %>"><%= wfl.name %></a></td>
    				<td class="version"><%= wfl.version %></td>
    				<td class="err in-progress"><%= wrapBadge(wfl['IN-PROGRESS'], getUrl('in-progress'), 'badge-warning') %></td>
    				<td class="err complete"><%= wrapBadge(wfl.COMPLETE, getUrl('complete'), 'badge-success') %></td>
    				<td class="err error"><%= wrapBadge(wfl.ERROR, getUrl('error'), 'badge-important') %></td>
    				<td class="err async-waiting"><%= wrapBadge(wfl['ASYNC-WAITING'], getUrl('async-waiting'), 'badge-waiting') %></td>
    				<td class="err waiting"><%= wrapBadge(wfl.WAITING, getUrl('waiting'), 'badge-waiting') %></td>
    				<td class="err incomplete"><%= wrapBadge(wfl.INCOMPLETE, getUrl('incomplete'), 'badge-info') %></td>
    				<td class="err canceled"><%= wrapBadge(wfl.CANCELED, getUrl('canceled'), 'badge-canceled') %></td>
    				<td class="err retry"><%= wrapBadge(wfl.RETRY, getUrl('/retry'), 'badge-error') %></td>
    				<td class="err ready"><%= wrapBadge(wfl.READY, getUrl('ready'), 'badge-ready') %></td>
    				<td class="err blocked"><%= wrapBadge(wfl.BLOCKED, getUrl('/blocked'), '') %></td>
    				<td class="err event-waiting"><%= wrapBadge(wfl['EVENT-WAITING'], getUrl('event-waiting'), 'badge-waiting') %></td>
    				<td class="err scheduled"><%= wrapBadge(wfl.SCHEDULED, getUrl('scheduled'), 'badge-info') %></td>
  					<td>
  						<div class="btn-group">
  						    <button class="btn dropdown-toggle" data-toggle="dropdown">
  						      <i class="icon-cog"></i>
  						      <span class="caret"></span>
                </button>
  					    <ul class="dropdown-menu pull-right">
    							<li><a href="#" class="action" data-action="start" data-id="<%= wfl.workflowid %>"><i class="icon-off"></i> Start</a></li>
    							<li><a href="#" class="action" data-action="start" data-id="<%= wfl.workflowid %>"><i class="icon-off"></i> Start Custom</a></li>
    							<li><a href="#" class="action" data-action="reset" data-id="<%= wfl.workflowid %>"><i class="icon-refresh"></i> Reset</a></li>
    							<li><a href="#" class="action" data-action="stop" data-id="<%= wfl.workflowid %>"><i class="icon-remove"></i> Stop</a></li>
  					    </ul>
             </div>
  					</td>
	  			</tr>
	        <% }); %>
		</tbody>
	</table>
  </div>
  <div class="push"></div>
</div>
