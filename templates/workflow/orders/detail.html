<% if (item.get('id')) { %>
<%  if (show_header) {  
      var itm = item.toJSON();
%>
  <h3><%= itm.name %> <small><%= itm.version%></small></h3>
  <p><%= wrapStatus(itm.workflowstatus) %> Workflow Instance ID: <%= itm.workflow_instanceid %></p>
<% } %>

<ul class="nav nav-tabs">
  <li class="active"><a href="#steps">Steps</a></li>
  <li><a href="#data">Data</a></li>
  <li><a href="#errors">Errors</a></li>
  <li><a href="#hierarchy">Hierarchy</a></li>
  <li><a href="#audit-events">Audit Events</a></li>
  <li><a href="#instance-info">Info</a></li>
</ul>

<div class="tab-content">
  <% 
    var it = item.toJSON();
    if (obj.workflow) {
       var wfl = workflow.toJSON();
    }
  %>

  <div class="tab-pane active" id="steps">
    <table class="table table-hover">
      <thead>
        <tr>
          <th></th>
          <th>Status</th> 
          <th class="name">Name</th>
          <th>Error Type</th>
          <th>Custom Status</th>
          <th>Ind</th>
          <th>Retries</th>
          <th>Skip</th>
          <th>Started</th>
          <th>Completed</th>
          <th>SubWFL IID</th>
        </tr>
      </thead>
      <tbody>
        <% _.each(it.StepInstances, function(step) { %>
        <tr class="<%= step.stepname %><% if (step.ind > 0) { %> substep<% } else { %> parent <% } %>"<% if (step.ind > 0) { %> data-parent="<%= step.stepname %>"<% } %>>
          <td><% if (step.ind > 0) { %>|<% } %></td>
          <td><%= wrapStatus(step.stepstatus) %></td> 
          <td class="name showstep" data-id="<%= step.stepid %>"><%= step.stepname %></td>
          <td><%= (step.business_error) ? 'Business' : 'Other' %></td>
          <td><%= step.custom_status %></td>
          <td><%= step.ind %></td>
          <td><%= step.retries %></td>
          <td><%= statusIcon(step.skip) %></td>
          <td><%= step.started %></td>
          <td><%= step.completed %></td>
          <td><% if (step.subworkflow_instanceid) { %>
            <a href="/orders/view/<%= step.subworkflow_instanceid %>"><%= step.subworkflow_instanceid %></a>
            <% } %>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <div class="tab-pane" id="data">
      <div class="accordion" id="accordion">
        <div class="accordion-group">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse1">
              Order Info
            </a>
          </div>
          <div id="collapse1" class="accordion-body collapse in">
            <div class="accordion-inner">
                <% if (it.keys) { %>
                  <div class="treeview">
                <%= createNestedList(it.keys) %>  
                  </div>
                <% } else { %>
                <p>No data</p>
                <% } %>
                </table>
            </div>
        </div>
      </div>
      <div class="accordion-group">
        <div class="accordion-heading">
          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse2">
            Static data
          </a>
        </div>
        <div id="collapse2" class="accordion-body collapse">
          <div class="accordion-inner">
              <% if (it.staticdata) { %>
                <div class="treeview">
              <%= createNestedList(it.staticdata) %>  
                </div>
              <% } else { %>
              <p>No data</p>
              <% } %>
          </div>
        </div>
      </div>
      <div class="accordion-group">
        <div class="accordion-heading">
          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse3">
            Dynamic data
          </a>
        </div>
        <div id="collapse3" class="accordion-body collapse">
          <div class="accordion-inner">
              <% if (it.dynamicdata) { %>
                <div class="treeview">
              <%= createNestedList(it.dynamicdata) %>  
                </div>
              <% } else { %>
              <p>No data</p>
              <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="errors">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>Severity</th>
          <th>Error Code</th>
          <th class="description">Description</th>
          <th>Step Name</th>
          <th>Ind</th>
          <th>Created</th>
          <th>Error Type</th>
          <th class="info">Info</th>
          <th>Retry</th>
        </tr>
      </thead>
      <tbody>
        <% _.each(it.ErrorInstances, function(error) { %>
        <tr>
          <td><%= error.severity %></td> 
          <td><%= error.error %></td>
          <td class="description"><%= error.description %></td>
          <td><%= getStepName(error.stepid) %></td>
          <td><%= error.ind %></td>  
          <td><%= error.created %></td>
          <td><%= (error.business_error) ? 'Business' : 'Other' %></td>
          <td class="info"><%= error.info %></td>
          <td><%= error.retry %></td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <div class="tab-pane" id="hierarchy">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>Status</th>
          <th>Business Error</th>
          <th>Custom Status</th>
          <th>Custom Status Description</th>
          <th>Errors</th>
          <th>Priority</th>
          <th>Scheduled</th>
          <th>Subworkflow</th>
          <th>Synchronous</th>
          <th>Warnings</th>
          <th>Workflow ID</th>
          <th>Workflow IID</th>
          <th>Parent Workflow IID</th>
          <th>Started</th>
          <th>Completed</th>
        </tr>
      </thead>
      <tbody>
        <% _.each(it.HierarchyInfo, function(ha) { %>
        <tr>
          <td><%= wrapStatus(ha.workflowstatus) %></td>
          <td>
          <% if (ha.business_error) { %>
            <span class="label label-important"><i class="icon-exclamation-sign icon-white"></i></span>
          <% } %>
          </td>
          <td><%= ha.custom_status %></td>
          <td><%= ha.custom_status_desc %></td>
          <td><%= ha.errors %></td>
          <td><%= ha.priority %></td>
          <td><%= ha.scheduled %></td>
          <td><%= statusIcon(ha.subworkflow) %></td>
          <td><%= ha.synchronous %></td>
          <td><%= ha.warnings %></td>
          <td><a href="<%= getUrl('showWorkflow', { id : ha.workflowid }) %>"><%= ha.name %></a></td>
          <td><a href="<%= getUrl('showOrder', { id : ha.workflow_instanceid }) %>"><%= ha.workflow_instanceid %></a></td>
          <td><%= ha.parent_workflow_instanceid %></td>           
          <td><%= ha.started %></td>          
          <td><%= ha.completed %></td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
  
  <div class="tab-pane" id="audit-events">
    <table class="table table-striped table-hover table-align-left">
      <thead>
        <tr>
          <th>Event Code</th>
          <th>Event ID</th>
          <th>Created</th>
          <th>Event</th>
          <th>Info</th>
          <th>Reason</th>
          <th>Source</th>
          <th>Who</th>
        </tr>
      </thead>
      <tbody>
        <% _.each(it.AuditEvents, function(audit) { %>
        <tr>
          <td><%= audit.audit_event_code %></td>
          <td><%= audit.audit_eventid %></td>
          <td><%= audit.created %></td>
          <td><%= audit.event %></td>
          <td><%= audit.info1 %></td>
          <td><%= audit.reason %></td>
          <td><%= audit.source %></td>
          <td><%= audit.who %></td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
  
  <div class="tab-pane" id="instance-info">
    <table class="table table-striped table-hover table-align-left">
          <tr>
            <td class="name">Name</td>
            <td><%= it.name %></td>
          </tr>
          <tr>
            <td class="name">Workflow Instance ID</td>
            <td><%= it.workflow_instanceid %></td>
          </tr>
          <tr>
            <td class="name">Workflow ID</td>
            <td><%= it.workflowid %></td>
          </tr>
          <tr>
            <td class="name">Status</td>
            <td><%= wrapStatus(it.workflowstatus) %></td>
          </tr>
          <tr>
            <td class="name">Session ID</td>
            <td><%= it.status_sessionid %></td>
          </tr>
          <tr>
            <td class="name">Started</td>
            <td><%= it.started %></td>
          </tr>
          <tr>
            <td class="name">Completed</td>
            <td><%= it.completed %></td>
          </tr>
          <tr>
            <td class="name">Modified</td>
            <td><%= it.modified %></td>
          </tr>
          <tr>
            <td class="name">Parent Instance</td>
            <td><%= it.parent_workflow_instanceid %></td>
          </tr>
          <tr>
            <td class="name">Synchronous</td>
            <td><%= it.synchronous %></td>
          </tr>
          <tr>
            <td class="name">Error Type</td>
            <td><%= it.business_error ? 'Business' : 'Other' %></td>
          </tr>
          <tr>
            <td class="name">Archive</td>
            <td><%= it.archive %></td>
          </tr>
          <tr>
            <td class="name">Warnings</td>
            <td><%= it.warning_count %></td>
          </tr>
          <tr>
            <td class="name">Errors</td>
            <td><%= it.error_count %></td>
          </tr>
          <tr>
            <td class="name">Custom Status</td>
            <td><%= it.custom_status %></td>
          </tr>
          <tr>
            <td class="name">Custom Status Description</td>
            <td><%= it.custom_status_desc %></td>
          </tr>
          <tr>
            <td class="name">Priority</td>
            <td><%= it.priority %></td>
          </tr>
          <tr>
            <td class="name">Scheduled</td>
            <td><%= it.scheduled %></td>
          </tr>
    </table>
  </div>
  
</div>
<!-- Modal -->
<div id="stepdetail" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="modalHeader" aria-hidden="true">
</div>
<div class="push"></div>
<% } %>