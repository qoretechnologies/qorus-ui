{"workflowid": 2,"name": "SIMPLETEST","version": "1.0","patch": "p1","description": "simple test workflow with 3 linear steps","author": "Qore Technologies, sro","autostart": 1,"manual_autostart": true,"errorfunction_instanceid": 19,"attach_func_instanceid": 1,"detach_func_instanceid": 2,"onetimeinit_func_instanceid": 21,"errhandler_func_instanceid": 16,"created": "2015-01-13 11:04:47.995196 +01:00","modified": "2015-01-13 11:04:47.995196 +01:00","enabled": true,"deprecated": false,"keylist": ["key1","key2","key3","key4","key5","key6","key7","key8","key9"],"stepmap": {"1": "test_function_1","4": "test_function_2","7": "test_function_3"},"steps": {"1": [],"4": [1],"7": [4]},"segment": [{"steplist": [1,4,7],"steps": {"1": [],"4": [1],"7": [4]}}],"options": [{"name": "fast-exec","desc": "enable simple and fast workflow execution"},{"name": "no-init-error","desc": "disable random onetimeinit error generation"},{"name": "throw-error","desc": "raise an error immediately regardless of other options"},{"name": "no-errors","desc": "disable error generation","value": 1}],"lib": {"functions": [{"name": "TestFunction1","version": "1.0","id": 14,"function_type": "GENERIC","description": "test function 1","author": "Qore Technologies, sro","body": "sub TestFunction1() {\n    return \"TestFunction1\";\n}\n","created": "2015-01-13 11:04:47.748064 +01:00","modified": "2015-01-13 11:04:47.748064 +01:00","createdby": "omq","modifiedby": "omq","tags": {},"source": "/Users/pchalupny/workspace/qorus/trunk/test/TEST-WORKFLOWS/test-functions-v1.0.qfd","offset": "232","host": "panda.local","user": "<shell-unknown>"},{"name": "TestFunction2","version": "1.0","id": 15,"function_type": "GENERIC","description": "test function 2","author": "Qore Technologies, sro","body": "sub TestFunction2() {\n    return \"TestFunction2\";\n}\n","created": "2015-01-13 11:04:47.751133 +01:00","modified": "2015-01-13 11:04:47.751133 +01:00","createdby": "omq","modifiedby": "omq","tags": {},"source": "/Users/pchalupny/workspace/qorus/trunk/test/TEST-WORKFLOWS/test-functions-v1.0.qfd","offset": "241","host": "panda.local","user": "<shell-unknown>"},{"name": "doTest","version": "2.0","id": 20,"function_type": "GENERIC","description": "test function for test workflows","author": "Qore Technologies, sro","body": "sub addValue($d) {\n    my $v = \"value-\" + (rand() % 100);\n    if (inlist($v, $d))\n\treturn sprintf(\"SKIPPED (%n)\", $v);\n    \n    if (!exists $d)\n\t$d = $v;\n    else if (type($d) != Type::List)\n\t$d = ($d, $v);\n    else\n\t$d += $v;\n\n    return $v;\n}\n\nsub test_keys() {\n    #my $k = getOrderKeys();\n\n    for (my int $i = 0; $i < 3; $i++) {\n\tmy $h;\n\tmy string $key = \"key\" + (rand() % 10);\n\tif ($key == \"key0\" && getOption(\"no-errors\"))\n\t    $key = \"key1\";\n\tmy $value;\n\tif (!(rand() % 4)) {\n\t    $value = ();\n\t    for (my $x = 0; $x < 3; $x++)\n\t\t$value += addValue(\\$h.$key);\n\t}\n\telse\n\t    $value = addValue(\\$h.$key);\n\n\tlog(LL_INFO, \"%s=%n\", $key, $value);\n\tsetOrderKeys($h);\n    }\n}\n\nsub doTest() {\n    if (get_option(\"throw-error\"))\n        throw \"RETRY-ERROR\", \"stop\";\n\n    if (getOption(\"fast-exec\"))\n\treturn;\n\n    if (getWorkflowInstanceData(\"mode\") == OMQ::WM_Recovery)\n\tlog(LL_INFO, \"stepInfo=%n\", getStepInfo());\n\n    my $hash{\"key\" + (rand() % 100)} = rand() % 100;\n    updateInstanceData($hash);\n    $hash{\"key\" + (rand() % 100)} = rand() % 100;\n    updateDynamicData($hash);\n    $hash{\"key\" + (rand() % 100)} = rand() % 100;\n    updateInstanceData($hash);\n    $hash{\"key\" + (rand() % 100)} = rand() % 100;\n    updateTempData($hash);\n\n    my $a = rand() % 20;\n\n    if (!getOption(\"no-errors\") && $a == 2) {\n\t# 50% chance of throwing \"TEST-BUSINESS-ERROR\"\n\tserror(!(rand() % 2) ? \"TEST-ERROR\" : \"TEST-BUSINESS-ERROR\");\n    }\n\n    log(LL_INFO, \"name: %y\", getWorkflowInstanceData(\"name\"));\n    log(LL_INFO, \"options: %y (no-errors: %y)\", getOption(), getOption(\"no-errors\"));\n\n    if (getWorkflowInstanceData(\"name\") == \"SIMPLETEST\") {\n        test_keys();\n\tif (!getOption(\"no-errors\") && $a == 3)\n\t    throw \"OH-NO!!!!!!!!\", \"scary error occured\";\n    }\n}\n","created": "2015-01-13 11:04:47.776741 +01:00","modified": "2015-01-13 11:04:47.776741 +01:00","createdby": "omq","modifiedby": "omq","tags": {},"source": "/Users/pchalupny/workspace/qorus/trunk/test/TEST-WORKFLOWS/test-functions-v1.0.qfd","offset": "355","host": "panda.local","user": "<shell-unknown>"}],"classes": [{"name": "TestClass1","version": "1.0","id": 1,"description": "test class","author": "Qore Technologies, sro","body": "class TestClass1 {\n    constructor() {\n\tprintf(\"TestClass1::constructor()\\n\");\n    }\n}\n","created": "2015-01-13 11:04:47.819895 +01:00","modified": "2015-01-13 11:04:47.819895 +01:00","createdby": "omq","modifiedby": "omq","tags": {},"source": "/Users/pchalupny/workspace/qorus/trunk/test/TEST-WORKFLOWS/test-v1.0.qclass","offset": "5","host": "panda.local","user": "<shell-unknown>"},{"name": "TestClass2","version": "1.0","id": 2,"description": "test class","author": "Qore Technologies, sro","body": "class TestClass2 {\n    constructor() {\n\tprintf(\"TestClass2::constructor()\\n\");\n    }\n}\n","created": "2015-01-13 11:04:47.824268 +01:00","modified": "2015-01-13 11:04:47.824268 +01:00","createdby": "omq","modifiedby": "omq","tags": {},"source": "/Users/pchalupny/workspace/qorus/trunk/test/TEST-WORKFLOWS/test-v1.0.qclass","offset": "16","host": "panda.local","user": "<shell-unknown>"}],"constants": [{"name": "TestConstants1","version": "1.0","id": 1,"description": "test constants 1","author": "Qore Technologies, sro","body": "const t1 = 1;\n","created": "2015-01-13 11:04:47.809955 +01:00","modified": "2015-01-13 11:04:47.809955 +01:00","createdby": "omq","modifiedby": "omq","tags": {},"source": "/Users/pchalupny/workspace/qorus/trunk/test/TEST-WORKFLOWS/test-v1.0.qconst","offset": "4","host": "panda.local","user": "<shell-unknown>"},{"name": "TestConstants2","version": "1.0","id": 2,"description": "test constants 2","author": "Qore Technologies, sro","body": "const t2 = 2;\n","created": "2015-01-13 11:04:47.813949 +01:00","modified": "2015-01-13 11:04:47.813949 +01:00","createdby": "omq","modifiedby": "omq","tags": {},"source": "/Users/pchalupny/workspace/qorus/trunk/test/TEST-WORKFLOWS/test-v1.0.qconst","offset": "11","host": "panda.local","user": "<shell-unknown>"}]},"mappers": null,"vmaps": null,"stepinfo": [{"name": "test_function_1","version": "1.0","author": "Qore Technologies, sro","steptype": "NORMAL","stepfunction_instanceid": 7,"arraytype": "NONE","created": "2015-01-13 11:04:47.876104 +01:00","sfname": "test_function_1","functions": [{"type": "primary","name": "test_function_1","version": "1.0","function_instanceid": 7,"function_type": "STEP","description": "test function 1","author": "Qore Technologies, sro","body": "sub test_function_1() {\n    updateDynamicData((\"test1\":now_us()));\n    setCustomStatus(\"A\");    \n    doTest();\n}\n","created": "2015-01-13 11:04:47.721701 +01:00","modified": "2015-01-13 11:04:47.721701 +01:00","createdby": "omq","modifiedby": "omq","tags": {},"source": "/Users/pchalupny/workspace/qorus/trunk/test/TEST-WORKFLOWS/test-functions-v1.0.qfd","offset": "95","host": "panda.local","user": "<shell-unknown>"}]},{"name": "test_function_2","version": "1.0","author": "Qore Technologies, sro","steptype": "NORMAL","stepfunction_instanceid": 8,"arraytype": "NONE","created": "2015-01-13 11:04:47.876104 +01:00","sfname": "test_function_2","functions": [{"type": "primary","name": "test_function_2","version": "1.0","function_instanceid": 8,"function_type": "STEP","description": "test function 2","author": "Qore Technologies, sro","body": "sub test_function_2() {\n    setCustomStatus(\"B\");\n    doTest();\n}\n","created": "2015-01-13 11:04:47.724749 +01:00","modified": "2015-01-13 11:04:47.724749 +01:00","createdby": "omq","modifiedby": "omq","tags": {},"source": "/Users/pchalupny/workspace/qorus/trunk/test/TEST-WORKFLOWS/test-functions-v1.0.qfd","offset": "106","host": "panda.local","user": "<shell-unknown>"}]},{"name": "test_function_3","version": "1.0","author": "Qore Technologies, sro","steptype": "NORMAL","stepfunction_instanceid": 9,"arraytype": "NONE","created": "2015-01-13 11:04:47.876104 +01:00","sfname": "test_function_3","functions": [{"type": "primary","name": "test_function_3","version": "1.0","function_instanceid": 9,"function_type": "STEP","description": "test function 3","author": "Qore Technologies, sro","body": "sub test_function_3() {\n    setCustomStatus(\"C\");\n    doTest();\n}\n","created": "2015-01-13 11:04:47.727808 +01:00","modified": "2015-01-13 11:04:47.727808 +01:00","createdby": "omq","modifiedby": "omq","tags": {},"source": "/Users/pchalupny/workspace/qorus/trunk/test/TEST-WORKFLOWS/test-functions-v1.0.qfd","offset": "116","host": "panda.local","user": "<shell-unknown>"}]}],"wffuncs": [{"type": "onetimeinit","name": "test_onetimeinitialization","version": "1.0","function_instanceid": 21,"function_type": "GENERIC","description": "test one time initialization function","author": "Qore Technologies, sro","created": "2015-01-13 11:04:47.780461 +01:00","modified": "2015-01-13 11:04:47.780461 +01:00","source": "/Users/pchalupny/workspace/qorus/trunk/test/TEST-WORKFLOWS/test-functions-v1.0.qfd","line": "433","body": "sub test_onetimeinitialization() {\n    my string $wfn = getWorkflowMetadata().name;\n    log(LL_INFO, \"one time initialization executing for workflow %n\", $wfn);\n\n    if (!getOption(\"no-errors\") && !getOption(\"no-init-error\") && !(rand() % 30))\n\tserror(\"TEST-INIT-ERROR\");\n}\n\n","createdby": "omq","modifiedby": "omq","tags": {},"offset": "433","host": "panda.local","user": "<shell-unknown>"},{"type": "errorfunction","name": "test_errors","version": "2.0","function_instanceid": 19,"function_type": "GENERIC","description": "test error function, provides the definitions for errors thrown by the test workflows","author": "Qore Technologies, sro","created": "2015-01-13 11:04:47.767732 +01:00","modified": "2015-01-13 11:04:47.767732 +01:00","source": "/Users/pchalupny/workspace/qorus/trunk/test/TEST-WORKFLOWS/test-functions-v1.0.qfd","line": "314","body": "sub test_errors() {\n    return \n\t( \"ASYNC-ERROR\" :\n\t  ( \"desc\"     : \"test error\",\n\t    \"severity\" : OMQ::ES_Major,\n\t    \"status\"   : OMQ::StatRetry ),\n\t  \"ASYNC-RECEIVE-ERROR\" :\n\t  ( \"desc\"     : \"test error\",\n\t    \"severity\" : OMQ::ES_Major,\n\t    \"status\"   : OMQ::StatRetry ),\n\t  \"TEST-BUSINESS-ERROR\" :\n\t  ( \"desc\"     : \"test business error\",\n\t    # if no severity is given, default=OMQ::ES_Major\n\t    # if no status is given, default=OMQ::StatError\n\t    \"business\" : True\n\t  ),\n\t  \"TEST-VALIDATION-ERROR\" :\n\t  ( \"desc\"     : \"test error\",\n\t    \"severity\" : OMQ::ES_Major,\n\t    \"status\"   : OMQ::StatRetry ),\n\t  \"TEST-INIT-ERROR\" :\n\t  ( \"desc\"     : \"test error\",\n\t    \"severity\" : OMQ::ES_Major,\n\t    \"status\"   : OMQ::StatRetry ),\n\t  \"TEST-ERROR\" :\n\t  ( \"desc\"     : \"test error\",\n\t    \"severity\" : OMQ::ES_Major,\n\t    \"status\"   : OMQ::StatRetry ),\n\t  \"TEST-EXCEPTION\" :\n\t  ( \"desc\"     : \"test error\",\n\t    \"severity\" : OMQ::ES_Major,\n\t    \"status\"   : OMQ::StatRetry )\n\t  );\n}\n","createdby": "omq","modifiedby": "omq","tags": {},"offset": "314","host": "panda.local","user": "<shell-unknown>"},{"type": "attachfunction","name": "attach_test","version": "1.0","function_instanceid": 1,"function_type": "GENERIC","description": "attach function test","author": "Qore Technologies, sro","created": "2015-01-13 11:04:47.679207 +01:00","modified": "2015-01-13 11:04:47.679207 +01:00","source": "/Users/pchalupny/workspace/qorus/trunk/test/TEST-WORKFLOWS/test-functions-v1.0.qfd","line": "7","body": "sub attach_test() {\n    log(LL_INFO, \"attach function test\");\n}\n","createdby": "omq","modifiedby": "omq","tags": {},"offset": "7","host": "panda.local","user": "<shell-unknown>"},{"type": "detachfunction","name": "detach_test","version": "1.0","function_instanceid": 2,"function_type": "GENERIC","description": "detach function test","author": "Qore Technologies, sro","created": "2015-01-13 11:04:47.702898 +01:00","modified": "2015-01-13 11:04:47.702898 +01:00","source": "/Users/pchalupny/workspace/qorus/trunk/test/TEST-WORKFLOWS/test-functions-v1.0.qfd","line": "16","body": "sub detach_test(string $stat) {\n    log(LL_INFO, \"detach function test, stat: %y\", $stat);\n    log(LL_INFO, \"static data: %y\", wf_get_static_data());\n}\n","createdby": "omq","modifiedby": "omq","tags": {},"offset": "16","host": "panda.local","user": "<shell-unknown>"},{"type": "errorhandlerfunction","name": "error_handler_test","version": "1.0","function_instanceid": 16,"function_type": "GENERIC","description": "error handler test function","author": "Qore Technologies, sro","created": "2015-01-13 11:04:47.754133 +01:00","modified": "2015-01-13 11:04:47.754133 +01:00","source": "/Users/pchalupny/workspace/qorus/trunk/test/TEST-WORKFLOWS/test-functions-v1.0.qfd","line": "250","body": "sub error_handler_test($err, $hash, $info) {\n    log(LL_INFO, \"error handler test, err=%n, hash=%n, info=%n\", $err, $hash, $info);\n}\n","createdby": "omq","modifiedby": "omq","tags": {},"offset": "250","host": "panda.local","user": "<shell-unknown>"}],"exec": [{"mode": "NORMAL","status": "waiting","iterations": 0,"totalSegments": 1,"starttime": "2016-04-01 13:23:24.742875 +02:00","logfile": "/Users/pchalupny/workspace/builds/qorus/log/OMQ-temnor-home-1-SIMPLETEST.log","options": {"no-errors": 1},"sync": false,"executionID": 5,"errors": 0,"warnings": 0,"alerts": [],"log_url": "ws://localhost:8001/log/workflows/2"}],"exec_count": 0,"connections": [],"groups": [{"name": "test","enabled": true,"size": 3},{"name": "SIMPLETEST","enabled": true,"size": 1}],"alerts": []}
